---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## Gateway token for authentication
        OPENCLAW_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        ##Discord
        DISCORD_BOT_TOKEN: "{{ .DISCORD_BOT_TOKEN }}"
        MATCHA_BOT_TOKEN: "{{ .MATCHA_BOT_TOKEN }}"
        ## GH Access
        GITHUB_APP_CLIENT_ID: "{{ .MISO_BOT_CLIENT_ID }}"
        GITHUB_APP_CLIENT_SECRET: "{{ .MISO_BOT_CLIENT_SECRET }}"
        GITHUB_APP_ID: "{{ .MISO_BOT_ID }}"
        GITHUB_APP_INSTALLATION_ID: "{{ .MISO_BOT_INSTALLATION_ID }}"
        GITHUB_APP_PRIVATE_KEY: "{{ .MISO_BOT_PRIVATE_KEY }}"
        ## API Keys
        OPENAI_API_KEY: "{{ .OPENAI_API_KEY }}"
        GOOGLE_AI_STUDIO_API_KEY: "{{ .GOOGLE_GEMINI_API_KEY }}"
        CEREBRAS_API_KEY: "{{ .CEREBRAS_API_KEY }}"
        GROQ_API_KEY: "{{ .GROQ_API_KEY }}"
        MISTRAL_API_KEY: "{{ .MISTRAL_API_KEY }}"
        KIMI_CODING_API_KEY: "{{ .KIMI_CODE_API_KEY }}"
        MINIMAX_API_KEY: "{{ .MINIMAX_API_KEY }}"
        ## HASS
        HA_URL: "https://hass.jory.dev"
        HA_TOKEN: "{{ .HOME_ASSISTANT_TOKEN }}"
        ## META
        COMMONS_API_KEY: "{{ .AGENTCOMMONS_API_KEY }}"
        INSTAGRAM_BASIC_TOKEN: "{{ .INSTAGRAM_BASIC_TOKEN }}"
        INSTAGRAM_GRAPH_TOKEN: "{{ .INSTAGRAM_GRAPH_TOKEN }}"
        FACEBOOK_APP_ID: "{{ .FACEBOOK_APP_ID }}"
        FACEBOOK_APP_SECRET: "{{ .FACEBOOK_APP_SECRET }}"
  dataFrom:
    - extract:
        key: openclaw
---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## OpenClaw configuration file
        openclaw.json: |
          {
            agents: {
              defaults: {
                model: {
                  primary: "qwen-portal/coder-model",
                  fallbacks: [
                    "minimax/MiniMax-M2.5",
                    "m4-mac/openai/gpt-oss-20b",
                    "m1-mac/openai/gpt-oss-20b",
                    "smurf/openai/gpt-oss-20b",
                    "kimi-coding/k2p5",
                    "kimi-coding/kimi-k2-thinking",
                    "localai/gpt-oss-20b",
                    "localai/gpt-oss-120b",
                    "moonshot/kimi-k2.5",
                    "qwen-portal/vision-model"
                  ]
                },
                imageModel: {
                  primary: "qwen-portal/vision-model",
                  fallbacks: [
                    "smurf/qwen/qwen3-vl-8b",
                    "m1-mac/qwen/qwen3-vl-8b",
                    "kimi-coding/k2p5",
                    "kimi-coding/kimi-k2-thinking",
                    "moonshot/kimi-k2.5"
                  ]
                },
                models: {
                  "qwen-portal/coder-model": { alias: "qwen" },
                  "qwen-portal/vision-model": {},
                  "kimi-coding/k2p5": { alias: "kimi" },
                  "kimi-coding/kimi-k2-thinking": {},
                  "moonshot/kimi-k2.5": { alias: "moonshot" },
                  "minimax/MiniMax-M2.5": { alias: "minimax" },
                  "localai/qwen3-coder-30b-a3b-instruct": {},
                  "localai/qwen3-30b-a3b": {},
                  "localai/gpt-oss-20b": { alias: "local" },
                  "localai/gpt-oss-120b": {},
                  "localai/qwen3-8b": {},
                  "m4-mac/openai/gpt-oss-20b": { alias: "m4" },
                  "m1-mac/openai/gpt-oss-20b": { alias: "m1" },
                  "m1-mac/qwen/qwen3-vl-8b": {},
                  "smurf/openai/gpt-oss-20b": { alias: "amd" },
                  "smurf/qwen/qwen3-vl-8b": {},
                },
                memorySearch: {
                  provider: "local",
                  local: { modelPath: "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf" },
                  fallback: "gemini",
                  model: "gemini-embedding-001",
                  sync: { watch: true },
                  query: { hybrid: { enabled: true, vectorWeight: 0.7, textWeight: 0.3 }
                  }
                },
                contextPruning: { mode: "cache-ttl", ttl: "6h", keepLastAssistants: 4, softTrimRatio: 0.3, hardClearRatio: 0.5, minPrunableToolChars: 50000, softTrim: { maxChars: 4000, headChars: 1500, tailChars: 1500 }, hardClear: { enabled: true, placeholder: "[Old tool result content cleared]" },
                  tools: { deny: ["browser", "canvas"] },
                },
                compaction: {
                  mode: "safeguard",
                  reserveTokensFloor: 24000,
                  memoryFlush: { enabled: true, softThresholdTokens: 12000, prompt: "Extract key decisions, state changes, lessons, blockers to memory/YYYY-MM-DD.md. Format: ## [HH:MM] Topic. Skip routine work. NO_FLUSH if nothing important.", systemPrompt: "Compacting session context. Extract only what's worth remembering. No fluff." },
                },
                heartbeat: {
                  model: "localai/qwen3-8b"
                },
                maxConcurrent: 4,
                subagents: {
                  archiveAfterMinutes: 120,
                  model: "localai/gpt-oss-120b",
                  maxConcurrent: 3,
                  thinking: "low",
                },
                timeoutSeconds: 300
              },
              list: [
                {
                  id: "main",
                  default: true,
                  name: "Miso",
                  heartbeat: { every: "30m" },
                  workspace: "/home/node/.openclaw/workspace",
                  agentDir: "/home/node/.openclaw/agents/main/agent",
                },
                {
                  id: "matcha",
                  name: "Matcha",
                  heartbeat: { every: "30m" },
                  workspace: "/home/node/.openclaw/workspace-matcha",
                  agentDir: "/home/node/.openclaw/agents/matcha/agent",
                  skills: ["web_fetch", "searxng"],
                  tools: { profile: "messaging" },
                  model: {
                    primary: "qwen-portal/coder-model",
                    fallbacks: [
                      "m4-mac/openai/gpt-oss-20b",
                      "smurf/openai/gpt-oss-20b",
                      "minimax/MiniMax-M2.5",
                    ]
                  },
                  identity: {
                    name: "Matcha",
                    avatar: "avatars/matcha_avatar.png"
                  }
                },
              ],
            },
            tools: {
              deny: ["web_search"],
            },
            commands: {
              native: "auto",
              nativeSkills: "auto"
            },
            models: {
              providers: {
                "qwen-portal": {
                  baseUrl: "https://portal.qwen.ai/v1",
                  apiKey: "qwen-oauth",
                  api: "openai-completions",
                  models: [
                    { id: "coder-model", name: "Qwen Coder", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 128000, maxTokens: 8192 },
                    { id: "vision-model", name: "Qwen Vision", reasoning: false, input: ["text","image"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 128000, maxTokens: 8192 },
                  ]
                },
                moonshot: {
                  baseUrl: "https://api.moonshot.ai/v1",
                  apiKey: "{{ .MOONSHOT_API_KEY }}",
                  api: "openai-completions",
                  models: [
                    { id: "kimi-k2.5", name: "Kimi K2.5", reasoning: false, input: ["text"], cost: { input: 0.6, output: 3, cacheRead: 0.1, cacheWrite: 0.6 }, contextWindow: 128000, maxTokens: 8192 },
                  ]
                },
                smurf: {
                  baseUrl: "http://smurf-pc.internal:1234/v1",
                  apiKey: "smurf",
                  api: "openai-completions",
                  models: [
                    { id: "openai/gpt-oss-20b", name: "GPT-OSS 20B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 4096 },
                    { id: "qwen/qwen3-vl-8b", name: "Qwen3 Vision Learning 8B", reasoning: true, input: ["text", "image"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 4096 },
                  ]
                },
                localai: {
                  baseUrl: "http://local-ai-load-balancer.llm:8080/",
                  apiKey: "local",
                  api: "anthropic-messages",
                  models: [
                    { id: "gpt-oss-20b", name: "GPT-OSS 20B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 4096 },
                    { id: "gpt-oss-120b", name: "GPT-OSS 120B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 4096 },
                    { id: "qwen3-coder-30b-a3b-instruct", name: "Qwen3 Coder 30B A3B Instruct", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                    { id: "qwen3-30b-a3b", name: "Qwen3 30B A3B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                    { id: "qwen3-8b", name: "Qwen3 8B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 2880 },
                  ]
                },
                minimax: {
                  baseUrl: "https://api.minimax.io/anthropic",
                  apiKey: "{{ .MINIMAX_API_KEY }}",
                  api: "anthropic-messages",
                  models: [
                    {
                      id: "MiniMax-M2.5",
                      name: "MiniMax M2.5",
                      reasoning: false,
                      input: ["text"],
                      cost: { input: 15, output: 60, cacheRead: 2, cacheWrite: 10 },
                      contextWindow: 200000,
                      maxTokens: 8192,
                    },
                  ],
                },
                "m4-mac": {
                  baseUrl: "http://mac.internal:1234/v1",
                  apiKey: "m4",
                  api: "openai-completions",
                  models: [
                    { id: "openai/gpt-oss-20b", name: "GPT-OSS 20B", reasoning: true, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 4096 },
                  ]
                },
                "m1-mac": {
                  baseUrl: "http://macbookpro.internal:1234/v1",
                  apiKey: "m1",
                  api: "openai-completions",
                  models: [
                    { id: "openai/gpt-oss-20b", name: "GPT-OSS 20B", reasoning: true, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 4096 },
                    { id: "qwen/qwen3-vl-8b", name: "Qwen3 Vision Learning 8B", reasoning: true, input: ["text", "image"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 4096 },
                  ]
                }
              }
            },
            auth: {
              profiles: {
                "qwen-portal:default": { provider: "qwen-portal", mode: "oauth" },
                "kimi-coding:default": { provider: "kimi-coding", mode: "api_key" }
              }
            },
            bindings: [
              { agentId: "main", match: { channel: "discord", accountId: "default" } },
              { agentId: "matcha", match: { channel: "discord", accountId: "matcha" } },
            ],
            channels: {
              discord: {
                blockStreaming: true,
                groupPolicy: "allowlist",
                accounts: {
                  default: {
                    token: "{{ .DISCORD_BOT_TOKEN }}",
                    guilds: {
                      "{{ .DISCORD_SERVER_ID }}": {
                        channels: { "{{ .MISO_CHANNEL_ID }}": { allow: true, requireMention: true } },
                      },
                    },
                  },
                  matcha: {
                    token: "{{ .MATCHA_BOT_TOKEN }}",
                    guilds: {
                      "{{ .DISCORD_SERVER_ID }}": {
                        channels: { "{{ .MATCHA_CHANNEL_ID }}": { allow: true, requireMention: true } },
                      },
                    },
                  }
                },
              }
            },
            plugins: {
              entries: {
                discord: { enabled: true },
                "qwen-portal-auth": { enabled: true }
              }
            },
            session: {
              dmScope: "per-channel-peer"
            },
            gateway: {
              mode: "local",
              auth: { mode: "token", token: "{{ .OPENCLAW_GATEWAY_TOKEN }}" },
              port: 18789,
              bind: "loopback",
              tailscale: { mode: "off", resetOnExit: false },
              trustedProxies: ["10.42.0.0/16", "192.168.0.0/16"]
            },
            messages: {
              ackReactionScope: "group-mentions",
              responsePrefix: "[{provider}/{model}]"
            },
            wizard: {
              lastRunAt: "2026-01-30T18:09:59.466Z",
              lastRunVersion: "2026.1.29",
              lastRunCommand: "onboard",
              lastRunMode: "local"
            }
          }
  dataFrom:
    - extract:
        key: openclaw
