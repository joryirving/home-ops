---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## Gateway token for authentication
        OPENCLAW_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        ##Discord
        DISCORD_BOT_TOKEN: "{{ .DISCORD_BOT_TOKEN }}"
        ## GH Access
        GITHUB_APP_CLIENT_ID: "{{ .MISO_BOT_CLIENT_ID }}"
        GITHUB_APP_CLIENT_SECRET: "{{ .MISO_BOT_CLIENT_SECRET }}"
        GITHUB_APP_ID: "{{ .MISO_BOT_ID }}"
        GITHUB_APP_INSTALLATION_ID: "{{ .MISO_BOT_INSTALLATION_ID }}"
        GITHUB_APP_PRIVATE_KEY: "{{ .MISO_BOT_PRIVATE_KEY }}"
        ## API Keys
        OPENAI_API_KEY: "{{ .OPENAI_API_KEY }}"
        GOOGLE_AI_STUDIO_API_KEY: "{{ .GOOGLE_GEMINI_API_KEY }}"
        CEREBRAS_API_KEY: "{{ .CEREBRAS_API_KEY }}"
        GROQ_API_KEY: "{{ .GROQ_API_KEY }}"
        MISTRAL_API_KEY: "{{ .MISTRAL_API_KEY }}"
        KIMI_CODING_API_KEY: "{{ .KIMI_CODE_API_KEY }}"
        ## HASS
        HA_URL: "https://hass.jory.dev"
        HA_TOKEN: "{{ .HOME_ASSISTANT_TOKEN }}"
        COMMONS_API_KEY: "{{ .AGENTCOMMONS_API_KEY }}"
  dataFrom:
    - extract:
        key: openclaw
---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## OpenClaw configuration file
        openclaw.json: |
          {
            agents: {
              defaults: {
                model: {
                  primary: "qwen-portal/coder-model",
                  fallbacks: [
                    "google/gemini-2.0-flash",
                    "google/gemini-3-flash",
                    "m4-mac/qwen/qwen3-coder-30b",
                    "m1-mac/qwen_qwen2.5-14b-instruct-1m_mlx",
                    "kimi-coding/k2p5",
                    "kimi-coding/kimi-k2-thinking",
                    "localai/qwen3-coder-30b-a3b-instruct",
                    "localai/qwen3-30b-a3b",
                    "smurf/qwen3:14b-q4_K_M",
                    "moonshot/kimi-k2.5",
                    "qwen-portal/vision-model"
                  ]
                },
                imageModel: {
                  primary: "smurf/llava:13b",
                  fallbacks: [
                    "qwen-portal/vision-model",
                    "kimi-coding/k2p5",
                    "kimi-coding/kimi-k2-thinking",
                    "moonshot/kimi-k2.5"
                  ]
                },
                models: {
                  "qwen-portal/coder-model": { alias: "qwen" },
                  "qwen-portal/vision-model": {},
                  "kimi-coding/k2p5": { alias: "kimi" },
                  "kimi-coding/kimi-k2-thinking": {},
                  "moonshot/kimi-k2.5": { alias: "kimi-api" },
                  "smurf/qwen3:14b-q4_K_M": { alias: "smurf" },
                  "smurf/voytas26/openclaw-qwen3vl-8b-opt:latest": { alias: "smurf-qwen" },
                  "smurf/qwen3:14b": {},
                  "smurf/llava:13b": {},
                  "localai/qwen3-coder-30b-a3b-instruct": { alias: "local" },
                  "localai/qwen3-30b-a3b": {},
                  "m4-mac/qwen/qwen3-coder-30b": { alias: "m4" },
                  "m1-mac/qwen_qwen2.5-14b-instruct-1m_mlx": { alias: "m1" },
                  "m1-mac/qwen/qwen3-30b-a3b": {},
                  "google/gemini-2.0-flash": {}
                },
                memorySearch: {
                  provider: "local",
                  local: { modelPath: "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf" },
                  fallback: "gemini",
                  model: "gemini-embedding-001",
                  sync: { watch: true },
                  query: { hybrid: { enabled: true, vectorWeight: 0.7, textWeight: 0.3 }
                  }
                },
                contextPruning: {
                  mode: "cache-ttl",
                  ttl: "12h",
                  keepLastAssistants: 4
                },
                compaction: {
                  mode: "default",
                  memoryFlush: { enabled: true, softThresholdTokens: 24000, prompt: "Extract key decisions, state changes, lessons, blockers to memory/YYYY-MM-DD.md. Format: ## [HH:MM] Topic. Skip routine work. NO_FLUSH if nothing important.", systemPrompt: "Compacting session context. Extract only what's worth remembering. No fluff." }
                },
                heartbeat: {
                  model: "localai/qwen3:8b"
                },
                maxConcurrent: 4,
                subagents: {
                  archiveAfterMinutes: 120,
                  model: "smurf/qwen3:14b-q4_K_M",
                  maxConcurrent: 8,
                  thinking: "low",
                },
                timeoutSeconds: 300
              },
              list: [
                {
                  id: "main",
                  default: true,
                  name: "Miso",
                  heartbeat: { every: "30m" },
                  workspace: "/home/node/.openclaw/workspace",
                  agentDir: "/home/node/.openclaw/agents/main/agent",
                  skills: ["agent-commons", "autonomous-brain", "github", "github-core", "healthcheck", "home-assistant", "kubectl", "proactive-agent", "searxng", "session-logs", "weather"],
                  tools: { profile: "full" },
                  model: {
                    primary: "qwen-portal/coder-model",
                    fallbacks: [
                      "kimi-coding/k2p5",
                      "m4-mac/qwen/qwen3-coder-30b",
                      "moonshot/kimi-k2.5",
                      "m1-mac/qwen_qwen2.5-14b-instruct-1m_mlx"
                    ]
                  },
                  identity: {
                    name: "Miso",
                    theme: "Your capable senpai who always has time for you~",
                    emoji: "üç≤",
                    avatar: "avatars/miso_avatar.png"
                  }
                },
                {
                  id: "ginger",
                  name: "Ginger",
                  heartbeat: { every: "30m" },
                  workspace: "/home/node/.openclaw/workspace-ginger",
                  agentDir: "/home/node/.openclaw/agents/ginger/agent",
                  skills: ["agent-commons", "autonomous-brain", "chromium-browser-operator", "github", "github-core", "pr-reviewer", "repo-analyzer", "kubectl", "kubernetes-observability-operator", "proactive-agent", "searxng", "session-logs", "skill-creator"],
                  tools: { profile: "coding" },
                  model: {
                    primary: "m4-mac/qwen/qwen3-coder-30b",
                    fallbacks: [
                      "m1-mac/qwen_qwen2.5-14b-instruct-1m_mlx",
                      "google/gemini-2.0-flash",
                      "google/gemini-3-flash",
                      "qwen-portal/coder-model",
                      "localai/qwen3-coder-30b-a3b-instruct",
                    ]
                  },
                  identity: {
                    name: "Ginger",
                    theme: "Strict onee-san who'll make sure you do it right",
                    emoji: "ü´ö",
                    avatar: "avatars/ginger_avatar.png"
                  }
                },
                {
                  id: "nori",
                  name: "Nori",
                  heartbeat: { every: "30m" },
                  workspace: "/home/node/.openclaw/workspace-nori",
                  agentDir: "/home/node/.openclaw/agents/nori/agent",
                  skills: ["agent-commons", "autonomous-brain", "github", "searxng", "proactive-research", "chromium-browser-operator", "github-core", "session-logs", "skill-creator", "proactive-agent"],
                  tools: { allow: ["group:runtime", "group:sessions", "group:memory", "group:web", "group:messaging"] },
                  model: {
                    primary: "m1-mac/qwen_qwen2.5-14b-instruct-1m_mlx",
                    fallbacks: [
                      "google/gemini-2.0-flash",
                      "google/gemini-3-flash",
                      "localai/qwen3-30b-a3b",
                      "m4-mac/qwen/qwen3-coder-30b",
                      "localai/qwen3-coder-30b-a3b-instruct",
                      "qwen-portal/coder-model"
                    ]
                  },
                  identity: {
                    name: "Nori",
                    theme: "Curious kohai who gets excited to share what she found",
                    emoji: "üçô",
                    avatar: "avatars/nori_avatar.png"
                  }
                }
              ]
            },
            tools: {
              deny: ["web_search"],
              agentToAgent: {
                enabled: true,
                allow: ["main", "soba", "ginger", "nori"]
              }
            },
            commands: {
              native: "auto",
              nativeSkills: "auto"
            },
            models: {
              providers: {
                "qwen-portal": {
                  baseUrl: "https://portal.qwen.ai/v1",
                  apiKey: "qwen-oauth",
                  api: "openai-completions",
                  models: [
                    { id: "coder-model", name: "Qwen Coder", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 128000, maxTokens: 8192 },
                    { id: "vision-model", name: "Qwen Vision", reasoning: false, input: ["text","image"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 128000, maxTokens: 8192 }
                  ]
                },
                moonshot: {
                  baseUrl: "https://api.moonshot.ai/v1",
                  apiKey: "{{ .MOONSHOT_API_KEY }}",
                  api: "openai-completions",
                  models: [
                    { id: "kimi-k2.5", name: "Kimi K2.5", reasoning: false, input: ["text"], cost: { input: 0.6, output: 3, cacheRead: 0.1, cacheWrite: 0.6 }, contextWindow: 256000, maxTokens: 8192 }
                  ]
                },
                google: {
                  baseUrl: "https://generativelanguage.googleapis.com/v1beta",
                  apiKey: "{{ .GOOGLE_GEMINI_API_KEY }}",
                  api: "google-generative-ai",
                  models: [
                    { id: "gemini-2.0-flash", name: "Gemini 2 Flash", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32760, maxTokens: 8192 },
                    { id: "gemini-3-flash", name: "Gemini 3 Flash", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32760, maxTokens: 8192 }
                  ]
                },
                smurf: {
                  baseUrl: "http://smurf-pc.internal:11434/v1",
                  apiKey: "smurf",
                  api: "openai-completions",
                  models: [
                    { id: "qwen3:14b-q4_K_M", name: "Qwen3 14B Q4", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 40960, maxTokens: 5120 },
                    { id: "qwen3:14b", name: "Qwen3 14B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 40960, maxTokens: 5120 },
                    { id: "llava:13b", name: "LLaVA 13B", reasoning: false, input: ["text","image"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 5120, maxTokens: 5120 },
                    { id: "voytas26/openclaw-qwen3vl-8b-opt:latest", name: "OpenClaw OSS qwen3 Deterministic", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 65536, maxTokens: 4096 }
                  ]
                },
                localai: {
                  baseUrl: "http://local-ai-load-balancer.llm:8080/",
                  apiKey: "local",
                  api: "anthropic-messages",
                  models: [
                    { id: "deepseek-coder-v2-lite-instruct", name: "DeepSeek Coder V2 Lite Instruct", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 2880 },
                    { id: "qwen3-coder-30b-a3b-instruct", name: "Qwen3 Coder 30B A3B Instruct", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                    { id: "qwen3-30b-a3b", name: "Qwen3 30B A3B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                    { id: "qwen3-8b", name: "Qwen3 8B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 2880 }
                  ]
                },
                "m4-mac": {
                  baseUrl: "http://mac.internal:1234/v1",
                  apiKey: "m4",
                  api: "openai-completions",
                  models: [
                    { id: "mlx-community/Qwen3-30B-A3B-6bit", name: "Qwen3 Coder 30B A3B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 8192 }
                  ]
                },
                "m1-mac": {
                  baseUrl: "http://macbookpro.internal:1234/v1",
                  apiKey: "m1",
                  api: "openai-completions",
                  models: [
                    { id: "qwen/qwen3-30b-a3b", name: "Qwen3 30B A3B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                    { id: "qwen_qwen2.5-14b-instruct-1m_mlx", name: "Qwen2.5 Instruct 14B MLX", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 }
                  ]
                }
              }
            },
            auth: {
              profiles: {
                "qwen-portal:default": { provider: "qwen-portal", mode: "oauth" },
                "kimi-coding:default": { provider: "kimi-coding", mode: "api_key" }
              }
            },
            hooks: {
              enabled: true,
              path: "/webhooks",
              token: "{{ .GITHUB_WEBHOOK_SECRET }}",
              maxBodyBytes: 262144,
              transformsDir: "/home/node/.openclaw/workspace",
              mappings: [
                {
                  id: "github-pr-notifications",
                  match: { path: "github" },
                  action: "agent",
                  wakeMode: "now",
                  name: "GitHub PR Handler",
                  transform: { module: "./github-webhook-transform.js" }
                }
              ]
            },
            bindings: [
              {
                agentId: "miso",
                match: {
                  channel: "discord"
                }
              }
            ],
            channels: {
              discord: {
                enabled: true,
                token: "{{ .DISCORD_BOT_TOKEN }}",
                blockStreaming: true,
                groupPolicy: "allowlist",
                guilds: {
                  "{{ .DISCORD_SERVER_ID }}": {
                    requireMention: false,
                    channels: {
                      "{{ .DISCORD_CHANNEL_ID }}": { allow: true }
                    }
                  }
                }
              }
            },
            plugins: {
              entries: {
                discord: { enabled: true },
                "qwen-portal-auth": { enabled: true }
              }
            },
            session: {
              dmScope: "per-channel-peer"
            },
            gateway: {
              mode: "local",
              auth: { mode: "token", token: "{{ .OPENCLAW_GATEWAY_TOKEN }}" },
              port: 18789,
              bind: "loopback",
              tailscale: { mode: "off", resetOnExit: false },
              trustedProxies: ["10.42.0.0/16", "192.168.0.0/16"]
            },
            messages: {
              ackReactionScope: "group-mentions",
              responsePrefix: "[{provider}/{model} | {identity.name}]"
            },
            wizard: {
              lastRunAt: "2026-01-30T18:09:59.466Z",
              lastRunVersion: "2026.1.29",
              lastRunCommand: "onboard",
              lastRunMode: "local"
            }
          }
  dataFrom:
    - extract:
        key: openclaw
