---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## Gateway token for authentication
        CLAWDBOT_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        ##Discord
        DISCORD_BOT_TOKEN: "{{ .DISCORD_BOT_TOKEN }}"
        ## GH Access
        GITHUB_APP_CLIENT_ID: "{{ .MISO_BOT_CLIENT_ID }}"
        GITHUB_APP_CLIENT_SECRET: "{{ .MISO_BOT_CLIENT_SECRET }}"
        GITHUB_APP_ID: "{{ .MISO_BOT_ID }}"
        GITHUB_APP_INSTALLATION_ID: "{{ .MISO_BOT_INSTALLATION_ID }}"
        GITHUB_APP_PRIVATE_KEY: "{{ .MISO_BOT_PRIVATE_KEY }}"
        ## API Keys
        GOOGLE_GEMINI_API_KEY: "{{ .GOOGLE_GEMINI_API_KEY }}"
        OPENAI_API_KEY: "{{ .OPENAI_API_KEY }}"
  dataFrom:
    - extract:
        key: openclaw
---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## OpenClaw configuration file
        openclaw.json: |
          {
            "commands": {
              "native": "auto",
              "nativeSkills": "auto"
            },
            "agents": {
              "defaults": {
                "model": {
                  "primary": "qwen-portal/coder-model",
                  "fallbacks": [
                    "google/gemini-3-flash",
                    "openai/gpt-4o-mini",
                    "ollama-smurf/qwen3:14b",
                    "ollama-k8s/gpt-oss-20b"
                  ]
                },
                "models": {
                  "qwen-portal/coder-model": {
                    "alias": "qwen"
                  },
                  "google/gemini-3-flash": {
                    "alias": "gemini"
                  },
                  "google/gemini-3-pro": {
                    "alias": "gemini3pro"
                  },
                  "openai/gpt-4o-mini": {
                    "alias": "openai"
                  },
                  "ollama-smurf/qwen3:8b": {
                    "alias": "smurf"
                  },
                  "ollama-k8s/gpt-oss-20b": {
                    "alias": "k8s"
                  }
                }
              }
            },
            "models": {
              "providers": {
                "qwen-portal": {
                  "baseUrl": "https://portal.qwen.ai/v1",
                  "apiKey": "qwen-oauth",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "coder-model",
                      "name": "Qwen Coder",
                      "reasoning": false,
                      "input": [
                        "text"
                      ],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 128000,
                      "maxTokens": 8192
                    },
                    {
                      "id": "vision-model",
                      "name": "Qwen Vision",
                      "reasoning": false,
                      "input": [
                        "text",
                        "image"
                      ],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 128000,
                      "maxTokens": 8192
                    }
                  ]
                },
                "google": {
                  "baseUrl": "https://generativelanguage.googleapis.com/v1beta",
                  "apiKey": "{{ .GOOGLE_GEMINI_API_KEY }}",
                  "api": "google-generative-ai",
                  "models": [
                    {
                      "id": "gemini-3-flash",
                      "name": "Gemini 3 Flash",
                      "reasoning": false,
                      "input": [
                        "text"
                      ],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 32760,
                      "maxTokens": 8192
                    }
                  ]
                },
                "ollama-smurf": {
                  "baseUrl": "http://smurf-pc:11434/v1",
                  "apiKey": "ollama-smurf",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "glm-4.7-flash-reap-23b-a3b",
                      "name": "GLM-4.7 Flash REAP-23B-A3B",
                      "reasoning": false,
                      "input": [
                        "text"
                      ],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 32768,
                      "maxTokens": 8192
                    }
                  ]
                },
                "ollama-k8s": {
                  "baseUrl": "http://ollama.llm:11434/v1",
                  "apiKey": "ollama-k8s",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "gpt-oss-20b",
                      "name": "GPT-OSS 20B",
                      "reasoning": false,
                      "input": [
                        "text"
                      ],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 4096,
                      "maxTokens": 4096
                    }
                  ]
                },
                "openai": {
                  "baseUrl": "https://api.openai.com/v1",
                  "apiKey": "{{ .OPENAI_API_KEY }}",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "gpt-4o-mini",
                      "name": "GPT-4o Mini",
                      "reasoning": false,
                      "input": [
                        "text"
                      ],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 128000,
                      "maxTokens": 16384
                    }
                  ]
                }
              }
            },
            "auth": {
              "profiles": {
                "qwen-portal:default": {
                  "provider": "qwen-portal",
                  "mode": "oauth"
                },
                "ollama-smurf:default": {
                  "provider": "ollama-smurf",
                  "mode": "api_key"
                },
                "ollama-k8s:default": {
                  "provider": "ollama-k8s",
                  "mode": "api_key"
                },
                "openai:default": {
                  "provider": "openai",
                  "mode": "api_key"
                }
              }
            },
            "hooks": {
              "enabled": true,
              "path": "/webhooks",
              "token": "{{ .GITHUB_WEBHOOK_SECRET }}",
              "maxBodyBytes": 262144,
              "transformsDir": "/home/node/.openclaw/workspace",
              "mappings": [
                {
                  "id": "github-pr-notifications",
                  "match": {
                    "path": "github"
                  },
                  "action": "agent",
                  "wakeMode": "now",
                  "name": "GitHub PR Handler",
                  "transform": {
                    "module": "./github-webhook-transform.js"
                  }
                }
              ]
            },
            "plugins": {
              "entries": {
                "discord": {
                  "enabled": true
                },
                "qwen-portal-auth": {
                  "enabled": true
                }
              }
            },
            "gateway": {
              "mode": "local",
              "auth": {
                "mode": "token",
                "token": "{{ .OPENCLAW_GATEWAY_TOKEN }}"
              },
              "port": 18789,
              "bind": "loopback",
              "tailscale": {
                "mode": "off",
                "resetOnExit": false
              },
              "trustedProxies": ["10.42.0.0/16", "192.168.0.0/16"]
            },
            "messages": {
              "ackReactionScope": "group-mentions"
            },
            "wizard": {
              "lastRunAt": "2026-01-30T18:09:59.466Z",
              "lastRunVersion": "2026.1.29",
              "lastRunCommand": "onboard",
              "lastRunMode": "local"
            }
          }
  dataFrom:
    - extract:
        key: openclaw
    - extract:
        key: github-bot
