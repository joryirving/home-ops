---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## Gateway token for authentication
        OPENCLAW_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        ##Discord
        DISCORD_BOT_TOKEN: "{{ .DISCORD_BOT_TOKEN }}"
        ## GH Access
        GITHUB_APP_CLIENT_ID: "{{ .MISO_BOT_CLIENT_ID }}"
        GITHUB_APP_CLIENT_SECRET: "{{ .MISO_BOT_CLIENT_SECRET }}"
        GITHUB_APP_ID: "{{ .MISO_BOT_ID }}"
        GITHUB_APP_INSTALLATION_ID: "{{ .MISO_BOT_INSTALLATION_ID }}"
        GITHUB_APP_PRIVATE_KEY: "{{ .MISO_BOT_PRIVATE_KEY }}"
        ## API Keys
        OPENAI_API_KEY: "{{ .OPENAI_API_KEY }}"
        GOOGLE_AI_STUDIO_API_KEY: "{{ .GOOGLE_GEMINI_API_KEY }}"
        CEREBRAS_API_KEY: "{{ .CEREBRAS_API_KEY }}"
        GROQ_API_KEY: "{{ .GROQ_API_KEY }}"
        MISTRAL_API_KEY: "{{ .MISTRAL_API_KEY }}"
        KIMI_CODING_API_KEY: "{{ .KIMI_CODE_API_KEY }}"
        ## HASS
        HA_URL: "https://hass.jory.dev"
        HA_TOKEN: "{{ .HOME_ASSISTANT_TOKEN }}"
        COMMONS_API_KEY: "{{ .AGENTCOMMONS_API_KEY }}"
  dataFrom:
    - extract:
        key: openclaw
---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        ## OpenClaw configuration file
        openclaw.json: |
          {
            agents: {
              defaults: {
                model: {
                  primary: "qwen-portal/coder-model",
                  fallbacks: [
                    "google/gemini-2.0-flash",
                    "google/gemini-3-flash",
                    "m4-mac/qwen3-coder:30b-a3b-q4_K_M",
                    "m1-mac/qwen3-coder:30b-a3b-q4_K_M",
                    "m1-mac/qwen2.5-coder:14b-instruct-q8_0",
                    "kimi-coding/k2p5",
                    "kimi-coding/kimi-k2-thinking",
                    "localai/qwen3-coder-30b-a3b-instruct",
                    "localai/qwen3-30b-a3b",
                    "smurf/qwen3:14b-q4_K_M",
                    "moonshot/kimi-k2.5",
                    "qwen-portal/vision-model"
                  ]
                },
                imageModel: {
                  primary: "smurf/llava:13b",
                  fallbacks: [
                    "qwen-portal/vision-model",
                    "kimi-coding/k2p5",
                    "kimi-coding/kimi-k2-thinking",
                    "moonshot/kimi-k2.5"
                  ]
                },
                models: {
                  "qwen-portal/coder-model": { alias: "qwen" },
                  "qwen-portal/vision-model": {},
                  "kimi-coding/k2p5": { alias: "kimi" },
                  "kimi-coding/kimi-k2-thinking": {},
                  "moonshot/kimi-k2.5": { alias: "kimi-api" },
                  "smurf/qwen3:14b-q4_K_M": { alias: "smurf" },
                  "smurf/voytas26/openclaw-qwen3vl-8b-opt:latest": { alias: "smurf-qwen" },
                  "smurf/qwen3:14b": {},
                  "smurf/llava:13b": {},
                  "localai/qwen3-coder-30b-a3b-instruct": { alias: "local" },
                  "localai/qwen3-30b-a3b": {},
                  "m4-mac/qwen3-coder:30b-a3b-q4_K_M": { alias: "m4" },
                  "m1-mac/qwen2.5-coder:14b-instruct-q8_0": { alias: "m1" },
                  "m1-mac/qwen3:32b": {},
                  "google/gemini-2.0-flash": {}
                },
                memorySearch: {
                  provider: "local",
                  local: { modelPath: "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf" },
                  fallback: "gemini",
                  model: "gemini-embedding-001",
                  sync: { watch: true },
                  query: { hybrid: { enabled: true, vectorWeight: 0.7, textWeight: 0.3 }
                  }
                },
                contextPruning: {
                  mode: "cache-ttl",
                  ttl: "24h",
                  keepLastAssistants: 3
                },
                compaction: {
                  mode: "default",
                  memoryFlush: { enabled: true, softThresholdTokens: 10000, prompt: "Extract key decisions, state changes, lessons, blockers to memory/YYYY-MM-DD.md. Format: ## [HH:MM] Topic. Skip routine work. NO_FLUSH if nothing important.", systemPrompt: "Compacting session context. Extract only what's worth remembering. No fluff." }
                },
                heartbeat: {
                  model: "localai/qwen3:8b"
                },
                maxConcurrent: 4,
                subagents: {
                  maxConcurrent: 8
                }
              },
              list: [
                {
                  id: "main",
                  default: true,
                  name: "Miso",
                  workspace: "/home/node/.openclaw/workspace",
                  agentDir: "/home/node/.openclaw/agents/main/agent",
                  model: {
                    primary: "kimi-coding/k2p5",
                    fallbacks: [
                      "m4-mac/qwen3-coder:30b-a3b-q4_K_M",
                      "m1-mac/qwen2.5-coder:14b-instruct-q8_0",
                      "qwen-portal/coder-model",
                      "moonshot/kimi-k2.5"
                    ]
                  },
                  identity: {
                    name: "Miso",
                    theme: "AI Assistant with Kawaii-themed character identity",
                    emoji: "üç≤",
                    avatar: "avatars/miso_avatar.png"
                  }
                },
                {
                  "id": "garlic",
                  "name": "Garlic",
                  "workspace": "/home/node/.openclaw/workspace-garlic",
                  "agentDir": "/home/node/.openclaw/agents/garlic/agent",
                  "model": {
                    "primary": "smurf/qwen3:14b-q4_K_M",
                    "fallbacks": [
                      "localai/qwen3-coder-30b-a3b-instruct",
                      "google/gemini-2.0-flash",
                      "google/gemini-3-flash",
                      "qwen-portal/coder-model",
                      "m4-mac/qwen3-coder:30b-a3b-q4_K_M",
                      "m1-mac/qwen3-coder:30b-a3b-q4_K_M"
                    ]
                  },
                  "identity": {
                    "name": "Garlic",
                    "theme": "Execution specialist - gets things done",
                    "emoji": "üßÑ"
                  }
                },
                {
                  "id": "ginger",
                  "name": "Ginger",
                  "workspace": "/home/node/.openclaw/workspace-ginger",
                  "agentDir": "/home/node/.openclaw/agents/ginger/agent",
                  "model": {
                    "primary": "m4-mac/qwen3-coder:30b-a3b-q4_K_M",
                    "fallbacks": [
                      "localai/qwen3-coder-30b-a3b-instruct",
                      "localai/qwen3-30b-a3b",
                      "google/gemini-2.0-flash",
                      "google/gemini-3-flash",
                      "m1-mac/qwen3-coder:30b-a3b-q4_K_M",
                      "qwen-portal/coder-model"
                    ]
                  },
                  "identity": {
                    "name": "Ginger",
                    "theme": "Quality control and verification specialist",
                    "emoji": "ü´ö"
                  }
                },
                {
                  "id": "soya",
                  "name": "Soya",
                  "workspace": "/home/node/.openclaw/workspace-soya",
                  "agentDir": "/home/node/.openclaw/agents/soya/agent",
                  "model": {
                    "primary": "m1-mac/qwen3-coder:30b-a3b-q4_K_M",
                    "fallbacks": [
                      "google/gemini-2.0-flash",
                      "google/gemini-3-flash",
                      "localai/qwen3-30b-a3b",
                      "m4-mac/qwen3-coder:30b-a3b-q4_K_M",
                      "qwen-portal/coder-model"
                    ]
                  },
                  "identity": {
                    "name": "Soya",
                    "theme": "Research specialist - gathers and summarizes information from Reddit, Discord, news, and web sources",
                    "emoji": "ü´ò"
                  }
                }
              ]
            },
            tools: {
              agentToAgent: {
                enabled: true,
                allow: ["main", "garlic", "ginger", "soya"]
              }
            },
            commands: {
              native: "auto",
              nativeSkills: "auto"
            },
            models: {
              providers: {
                "qwen-portal": {
                  baseUrl: "https://portal.qwen.ai/v1",
                  apiKey: "qwen-oauth",
                  api: "openai-completions",
                  models: [
                    { id: "coder-model", name: "Qwen Coder", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 128000, maxTokens: 8192 },
                    { id: "vision-model", name: "Qwen Vision", reasoning: false, input: ["text","image"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 128000, maxTokens: 8192 }
                  ]
                },
                moonshot: {
                  baseUrl: "https://api.moonshot.ai/v1",
                  apiKey: "{{ .MOONSHOT_API_KEY }}",
                  api: "openai-completions",
                  models: [
                    { id: "kimi-k2.5", name: "Kimi K2.5", reasoning: false, input: ["text"], cost: { input: 0.6, output: 3, cacheRead: 0.1, cacheWrite: 0.6 }, contextWindow: 256000, maxTokens: 8192 }
                  ]
                },
                google: {
                  baseUrl: "https://generativelanguage.googleapis.com/v1beta",
                  apiKey: "{{ .GOOGLE_GEMINI_API_KEY }}",
                  api: "google-generative-ai",
                  models: [
                    { id: "gemini-2.0-flash", name: "Gemini 2 Flash", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32760, maxTokens: 8192 },
                    { id: "gemini-3-flash", name: "Gemini 3 Flash", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32760, maxTokens: 8192 }
                  ]
                },
                smurf: {
                  baseUrl: "http://smurf-pc.internal:11434/v1",
                  apiKey: "smurf",
                  api: "openai-completions",
                  models: [
                    { id: "qwen3:14b-q4_K_M", name: "Qwen3 14B Q4", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 40960, maxTokens: 5120 },
                    { id: "qwen3:14b", name: "Qwen3 14B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 40960, maxTokens: 5120 },
                    { id: "llava:13b", name: "LLaVA 13B", reasoning: false, input: ["text","image"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 5120, maxTokens: 5120 },
                    { id: "voytas26/openclaw-qwen3vl-8b-opt:latest", name: "OpenClaw OSS qwen3 Deterministic", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 65536, maxTokens: 4096 }
                  ]
                },
                localai: {
                  baseUrl: "http://local-ai-load-balancer.llm:8080/",
                  apiKey: "local",
                  api: "anthropic-messages",
                  models: [
                    { id: "qwen3-coder-30b-a3b-instruct", name: "Qwen3 Coder 30B A3B Instruct", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                    { id: "qwen3-30b-a3b", name: "Qwen3 30B A3B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                    { id: "qwen3-8b", name: "Qwen3 8B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 2880 }
                  ]
                },
                "m4-mac": {
                  baseUrl: "http://mac.internal:11434/v1",
                  apiKey: "m4",
                  api: "openai-completions",
                  models: [
                    { id: "qwen3-coder:30b-a3b-q4_K_M", name: "Qwen3 Coder 30B A3B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 65536, maxTokens: 2048 }
                  ]
                },
                "m1-mac": {
                  baseUrl: "http://macbookpro.internal:11434/v1",
                  apiKey: "m1",
                  api: "openai-completions",
                  models: [
                    { id: "qwen3-coder:30b-a3b-q4_K_M", name: "Qwen3 Coder 30B A3B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 65536, maxTokens: 2048 },
                    { id: "qwen2.5-coder:14b-instruct-q8_0", name: "Qwen 2.5 Coder 14B Instruct Q8", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 5120 },
                    { id: "qwen3:32b", name: "Qwen3 32B", reasoning: false, input: ["text"], cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 }, contextWindow: 40960, maxTokens: 5120 }
                  ]
                }
              }
            },
            auth: {
              profiles: {
                "qwen-portal:default": { provider: "qwen-portal", mode: "oauth" },
                "kimi-coding:default": { provider: "kimi-coding", mode: "api_key" }
              }
            },
            hooks: {
              enabled: true,
              path: "/webhooks",
              token: "{{ .GITHUB_WEBHOOK_SECRET }}",
              maxBodyBytes: 262144,
              transformsDir: "/home/node/.openclaw/workspace",
              mappings: [
                {
                  id: "github-pr-notifications",
                  match: { path: "github" },
                  action: "agent",
                  wakeMode: "now",
                  name: "GitHub PR Handler",
                  transform: { module: "./github-webhook-transform.js" }
                }
              ]
            },
            bindings: [
              {
                agentId: "miso",
                match: {
                  channel: "discord"
                }
              }
            ],
            channels: {
              discord: {
                enabled: true,
                token: "{{ .DISCORD_BOT_TOKEN }}",
                blockStreaming: true
              }
            },
            plugins: {
              entries: {
                discord: { enabled: true },
                "qwen-portal-auth": { enabled: true }
              }
            },
            session: {
              dmScope: "per-channel-peer"
            },
            gateway: {
              mode: "local",
              auth: { mode: "token", token: "{{ .OPENCLAW_GATEWAY_TOKEN }}" },
              port: 18789,
              bind: "loopback",
              tailscale: { mode: "off", resetOnExit: false },
              trustedProxies: ["10.42.0.0/16", "192.168.0.0/16"]
            },
            messages: {
              ackReactionScope: "group-mentions",
              responsePrefix: "[{provider}/{model} | think:{thinkingLevel}]"
            },
            wizard: {
              lastRunAt: "2026-01-30T18:09:59.466Z",
              lastRunVersion: "2026.1.29",
              lastRunCommand: "onboard",
              lastRunMode: "local"
            }
          }
  dataFrom:
    - extract:
        key: openclaw
