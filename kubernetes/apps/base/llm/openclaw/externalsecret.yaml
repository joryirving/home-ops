---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      engineVersion: v2
      data:
        ## Gateway token for authentication (must match between env var and config)
        CLAWDBOT_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        ##Discord
        DISCORD_BOT_TOKEN: "{{ .DISCORD_BOT_TOKEN }}"
        ## GH Access
        GITHUB_APP_ID: "{{ .BOT_APP_ID }}"
        GITHUB_APP_INSTALLATION_ID: "38914879"
        GITHUB_APP_PRIVATE_KEY: "{{ .BOT_APP_PRIVATE_KEY }}"
        ## API Keys
        GOOGLE_GEMINI_API_KEY: "{{ .GOOGLE_GEMINI_API_KEY }}"
        OPENAI_API_KEY: "{{ .OPENAI_API_KEY }}"
        ## OpenClaw configuration file
        openclaw.json: |
          {
            "agents": {
              "defaults": {
                "model": {
                  "primary": "qwen-portal/coder-model",
                  "fallbacks": [
                    "google/gemini-3-pro",
                    "openai/gpt-4o-mini",
                    "ollama-smurf/glm-4.7-flash-reap-23b-a3b",
                    "ollama-k8s/gpt-oss-20b"
                  ]
                }
              }
            },
            "gateway": {
              "port": 18789,
              "mode": "local",
              "auth": {
                "mode": "token",
                "token": "{{ .OPENCLAW_GATEWAY_TOKEN }}"
              },
              "trustedProxies": [
                "10.0.0.0/8",
                "172.16.0.0/12",
                "192.168.0.0/16",
                "127.0.0.1/8"
              ]
            },
            "plugins": {
              "entries": {
                "discord": {
                  "enabled": true
                },
                "qwen-portal-auth": {
                  "enabled": true
                }
              }
            }
          }
  dataFrom:
    - extract:
        key: openclaw
    - extract:
        key: github-bot