---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/helm.toolkit.fluxcd.io/helmrelease_v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: openclaw
  namespace: llm
spec:
  interval: 15m
  chartRef:
    kind: OCIRepository
    name: app-template
    namespace: flux-system
  values:
    controllers:
      openclaw:
        replicas: 1
        strategy: RollingUpdate
        rollingUpdate:
          maxUnavailable: 0
          maxSurge: 1
        annotations:
          reloader.stakater.com/auto: "true"
        containers:
          app:
            image:
              repository: ghcr.io/openclaw/openclaw
              tag: 2026.1.30
            envFrom:
              - secretRef:
                  name: openclaw
            env:
              - name: NODE_ENV
                value: "production"
              - name: CLAWDBOT_GATEWAY_TOKEN
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: CLAWDBOT_GATEWAY_TOKEN
              - name: DISCORD_BOT_TOKEN
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: DISCORD_BOT_TOKEN
              - name: GITHUB_APP_CLIENT_ID
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: GITHUB_APP_CLIENT_ID
              - name: GITHUB_APP_CLIENT_SECRET
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: GITHUB_APP_CLIENT_SECRET
              - name: GITHUB_APP_ID
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: GITHUB_APP_ID
              - name: GITHUB_APP_INSTALLATION_ID
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: GITHUB_APP_INSTALLATION_ID
              - name: GITHUB_APP_PRIVATE_KEY
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: GITHUB_APP_PRIVATE_KEY
              - name: GOOGLE_GEMINI_API_KEY
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: GOOGLE_GEMINI_API_KEY
              - name: OPENAI_API_KEY
                valueFrom:
                  secretKeyRef:
                    name: openclaw
                    key: OPENAI_API_KEY
            resources:
              requests:
                cpu: 100m
                memory: 512Mi
              limits:
                memory: 1Gi
    defaultPodOptions:
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        fsGroupChangePolicy: "OnRootMismatch"
    service:
      app:
        ports:
          http:
            port: 3000
    networkPolicy:
      enabled: false
    persistence:
      config:
        type: secret
        name: openclaw-config
        globalMounts:
          - readOnly: true
            path: /home/node/.openclaw/workspace/openclaw.json
            subPath: openclaw.json
      hooks-scripts:
        type: configMap
        name: openclaw-hooks-scripts
        defaultMode: 0755
        globalMounts:
          - readOnly: true
            path: /home/node/.openclaw/workspace/github-webhook-transform.js
            subPath: github-webhook-transform.js
          - readOnly: true
            path: /home/node/.openclaw/workspace/github-app-token-manager.js
            subPath: github-app-token-manager.js
          - readOnly: true
            path: /home/node/.openclaw/workspace/grumpy-sysadmin-agent.js
            subPath: grumpy-sysadmin-agent.js