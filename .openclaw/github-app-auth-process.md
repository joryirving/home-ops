# GitHub App Authentication Process

This document describes how to authenticate with GitHub using the App credentials available in the environment.

## Prerequisites

The following environment variables must be available:
- `GITHUB_APP_ID`: [App ID value hidden]
- `GITHUB_APP_INSTALLATION_ID`: [Installation ID value hidden]
- `GITHUB_APP_PRIVATE_KEY`: [RSA private key hidden, contains -----BEGIN RSA PRIVATE KEY----- ... -----END RSA PRIVATE KEY-----]

## Authentication Steps

### 1. Install Required Dependencies

```bash
pip3 install pyjwt requests cryptography --break-system-packages
```

### 2. Generate Access Token

The access token is generated by:
1. Creating a JWT token signed with the private key
2. Exchanging the JWT for an installation access token

### 3. Authenticate GitHub CLI

```bash
echo "$GH_TOKEN" | gh auth login --with-token
```

### 4. Clone Repository with Authentication

```bash
git clone https://x-access-token:$GH_TOKEN@github.com/username/repo.git
# Or for existing repo:
git remote set-url origin https://x-access-token:$GH_TOKEN@github.com/username/repo.git
```

### 5. Create Pull Requests

```bash
gh pr create --title "Title" --body "Description" --head branch-name --repo username/repo
```

## Important Notes

- The access token expires after 1 hour
- The token needs to be regenerated for long-running operations
- The token provides write access to repositories based on the GitHub App permissions

## Using the API to Edit Pull Requests

GitHub Apps can programmatically update pull requests using the REST API. Here's how to edit a PR using the installation access token:

### Update PR Description

```bash
curl -X PATCH \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Accept: application/vnd.github+json" \
  -H "X-GitHub-Api-Version: 2022-11-28" \
  https://api.github.com/repos/OWNER/REPO/pulls/PULL_REQUEST_NUMBER \
  -d '{"body":"New PR description content"}'
```

### Reopen a Closed PR

```bash
curl -X PATCH \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Accept: application/vnd.github+json" \
  -H "X-GitHub-Api-Version: 2022-11-28" \
  https://api.github.com/repos/OWNER/REPO/pulls/PULL_REQUEST_NUMBER \
  -d '{"state":"open"}'
```

### Update Other PR Properties

```bash
curl -X PATCH \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Accept: application/vnd.github+json" \
  -H "X-GitHub-Api-Version: 2022-11-28" \
  https://api.github.com/repos/OWNER/REPO/pulls/PULL_REQUEST_NUMBER \
  -d '{"title":"New Title", "body":"New description", "state":"open"}'
```

### Required Permissions

Make sure your GitHub App has the following permissions:
- Pull requests: Read & write
- Issues: Read & write (sometimes required for PR operations)
- Metadata: Read (required by GitHub for all apps)

### Common Use Cases

- Updating PR descriptions to add documentation
- Adding instructions or footers to PRs
- Reopening PRs that were closed by mistake
- Updating PR titles or descriptions based on automated processes