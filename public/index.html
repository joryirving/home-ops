<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>OpenClaw Chat</title>
  <style>
    :root {
      --bg-primary: #0d0d14;
      --bg-secondary: #161625;
      --bg-tertiary: #1e1e32;
      --accent: #e94560;
      --accent-gradient: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
      --text-primary: #ffffff;
      --text-secondary: #a0a0b8;
      --border: #2a2a40;
      --safe-area-top: env(safe-area-inset-top, 20px);
      --safe-area-bottom: env(safe-area-inset-bottom, 20px);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
    }
    .header {
      background: var(--bg-secondary);
      padding: calc(var(--safe-area-top) + 12px) 16px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
    }
    .header h1 { font-size: 18px; }
    .logout { 
      background: var(--bg-tertiary); 
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
    }
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 16px;
      word-wrap: break-word;
    }
    .message.miso {
      background: var(--bg-tertiary);
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    .message.user {
      background: var(--accent-gradient);
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    .message img { max-width: 100%; border-radius: 12px; margin-top: 8px; }
    .quick-actions {
      display: flex;
      gap: 8px;
      padding: 12px 16px;
      overflow-x: auto;
      background: var(--bg-secondary);
    }
    .quick-btn {
      flex-shrink: 0;
      padding: 10px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 20px;
      color: var(--text-primary);
      font-size: 14px;
      white-space: nowrap;
    }
    .input-area {
      background: var(--bg-secondary);
      padding: calc(var(--safe-area-bottom) + 12px) 16px 16px;
      display: flex;
      gap: 12px;
    }
    .input-wrapper { flex: 1; }
    input {
      width: 100%;
      padding: 14px 18px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 24px;
      color: var(--text-primary);
      font-size: 16px;
    }
    input:focus { outline: none; border-color: var(--accent); }
    .send-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: none;
      background: var(--accent-gradient);
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    .status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ff4757;
    }
    .status-dot.connected { background: #2ed573; }
  </style>
</head>
<body>
  <header class="header">
    <div>
      <h1>üç≤ Miso</h1>
      <div class="status">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">Connecting...</span>
      </div>
    </div>
    <form action="/logout" method="POST">
      <button class="logout" type="submit">Logout</button>
    </form>
  </header>
  
  <div class="messages" id="messages">
    <div class="message miso">Hey there! üëã Connected! What would you like?</div>
  </div>
  
  <div class="quick-actions">
    <button class="quick-btn" onclick="quickAction('generate')">üé≤ Generate</button>
    <button class="quick-btn" onclick="quickAction('casual')">üëï Casual</button>
    <button class="quick-btn" onclick="quickAction('elegant')">üëó Elegant</button>
    <button class="quick-btn" onclick="quickAction('cute')">‚ú® Cute</button>
  </div>
  
  <div class="input-area">
    <div class="input-wrapper">
      <input type="text" id="messageInput" placeholder="Message Miso..." autocomplete="off">
    </div>
    <button class="send-btn" onclick="sendMessage()">‚û§</button>
  </div>

  <script>
    let ws = null;
    const messagesDiv = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    
    function connect() {
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      ws = new WebSocket(`${protocol}//${window.location.host}`);
      
      ws.onopen = () => {
        statusDot.classList.add('connected');
        statusText.textContent = 'Online';
      };
      
      ws.onclose = () => {
        statusDot.classList.remove('connected');
        statusText.textContent = 'Offline';
        setTimeout(connect, 3000);
      };
      
      ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          if (data.content || data.text) {
            addMessage('miso', data.content || data.text);
          }
          if (data.images) {
            data.images.forEach(img => addImage(img));
          }
        } catch {
          addMessage('miso', event.data);
        }
      };
    }
    
    function addMessage(sender, content) {
      const div = document.createElement('div');
      div.className = `message ${sender}`;
      div.textContent = content;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    function addImage(url) {
      const div = document.createElement('div');
      div.className = 'message miso';
      const img = document.createElement('img');
      img.src = url;
      img.onload = () => messagesDiv.scrollTop = messagesDiv.scrollHeight;
      div.appendChild(img);
      messagesDiv.appendChild(div);
    }
    
    function sendMessage(text = null) {
      const msg = text || messageInput.value.trim();
      if (!msg || !ws || ws.readyState !== WebSocket.OPEN) return;
      addMessage('user', msg);
      messageInput.value = '';
      ws.send(JSON.stringify({ type: 'message', content: msg }));
    }
    
    function quickAction(action) {
      const messages = {
        'generate': 'üé≤ Generate a random image',
        'casual': 'üëï Show me something casual',
        'elegant': 'üëó Show me something elegant',
        'cute': '‚ú® Show me something cute'
      };
      sendMessage(messages[action] || action);
    }
    
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
    
    connect();
  </script>
</body>
</html>
